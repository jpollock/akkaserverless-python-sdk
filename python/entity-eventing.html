<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subscribing to a journal :: Akka Serverless Python SDK Documentation</title>
    <link rel="prev" href="forwarding.html">
    <link rel="next" href="topic-eventing.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/theme.1.1.0.min.css">
    <style>
        .article {
            font-family: acumin-pro,Helvetica,Arial,sans-serif;
        }
        
        .site-id {
            left: 220px;
            font-size: 18px;
        }
        .header-logo {
            height: 80px;
        }
        .navbar .button {
            background-color: #ff931dff;
            color: white;
        }
    </style>

	<meta property="og:site_name" content="Lightbend Documentation" />
	<meta name="author" content="Lightbend Documentation">
	<link rel="shortcut icon" type="image/x-icon" href="../_/img/favicons/favicon.ico" />
	<meta itemprop="image" content="https://downloads.lightbend.com/website/social/lightbend-logo-orange-twitter.jpg">
	<meta name="twitter:image:src" content="https://downloads.lightbend.com/website/social/lightbend-logo-orange-twitter.jpg">
	<meta property="og:image" content="https://downloads.lightbend.com/website/social/lightbend-logo-orange-twitter.jpg" />
	<meta property="og:image:secure_url" content="https://downloads.lightbend.com/website/social/lightbend-logo-orange-twitter.jpg" />  </head>
  <body class="article production hide-versions ">
<header class="header" role="banner">
  <nav class="navbar">
      <div class="navbar-brand">
        <a class="navbar-item" href="#">
          <img class="header-logo lightbend-logo" src="../_/img/akka-serverless-full-color.svg">&nbsp;&nbsp;Python SDK Documentation
        </a>
      </div>
      <div id="topbar-nav" class="navbar-menu">
        <div class="navbar-end">
            <div class="navbar-item has-dropdown is-hoverable">
            <span class="navbar-link">Console</span>
            <div class="navbar-dropdown">
              <section>
                <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://console.akkaserverless.com/p/login/" target="_blank">Register or Log in</a>
                <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://status.akkaserverless.com/" target="_blank">Akka Serverless Status</a>
              </section>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <span class="navbar-link">Resources</span>
            <div class="navbar-dropdown">
              <section>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://discuss.lightbend.com/c/akka-serverless/40" target="
                  ">Discussion Forum</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/blog" target="_blank">Lightbend Blog</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://academy.lightbend.com/" target="_blank">Lightbend Academy</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://academy.lightbend.com/courses?search_query=FILTER_TYPE_FREE" target="_blank">Free Training</a>
              </section>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <span class="navbar-link">Lightbend</span>
            <div class="navbar-dropdown">
              <section>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/about-lightbend" target="_blank">Who Is Lightbend?</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/customers" target="_blank">Who Uses Lightbend?</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/certified-reactive-architect" target="_blank">Certification</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/company/news" target="_blank">News & Press</a>
                  <a data-category="Link - Drop Down Link - Lightbend Docs" href="https://www.lightbend.com/contact" target="_blank">Get In Contact</a>
              </section>
            </div>
          </div>
        </div>
      </div>

  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Developing with Python</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/development-process-python.html">Process overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kickstart.html">Kickstart a Python module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="proto.html">Writing gRPC descriptors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="eventsourced.html">Implementing Event Sourced Entities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="value-entity.html">Implementing Value Entities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="actions.html">Implementing Actions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="forwarding.html">Forwarding and effects</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="entity-eventing.html">Subscribing to a Journal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="topic-eventing.html">Publishing and Subscribing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="views.html">Creating Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="run-locally.html">Run a service locally</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title"></span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html"></a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Developing with Python</a></li>
    <li><a href="entity-eventing.html">Subscribing to a Journal</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/jpollock/akkaserverless-python-sdk/edit/main/docs/src/modules/python/pages/entity-eventing.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="On This Page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article id="page-content" class="doc">
<h1 class="page">Subscribing to a journal</h1>
<fieldset class="supergroup-switch">
	




	


</fieldset><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Event Sourced Entity journal contains events that capture all state changes. By subscribing to the journal, with the Event Sourced Entity type name, another component can receive all events emitted of that type.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Use case: send asynchronous messages</div>
<div class="paragraph">
<p>By combining the processing of a journal with <a href="topic-eventing.html" class="page">publishing to brokers</a>, a service can trigger other services asynchronously via messaging.
To achieve this, create an <a href="actions.html" class="page">Action</a> that subscribes to a journal and publishes messages to a topic.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Use case: external calls</div>
<div class="paragraph">
<p>A service might need to trigger other systems when certain events happened to an Entity. An Action can be connected to the Entity&#8217;s journal and react on certain events to issue calls (eg. via HTTP or gRPC).
To achieve this, create an <a href="actions.html" class="page">Action</a> that subscribes to a journal and let the implementation call other services.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_subscribing"><a class="anchor" href="#_subscribing"></a>Subscribing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To subscribe to an Event Sourced Entity log, define Protobuf rpc methods for each Journal event that you want to receive. Annotate these methods with the <code>(akkaserverless.method).eventing</code> annotation and specify the Entity type name of the Event Sourced Entity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-protobuf hljs" data-lang="protobuf">syntax = "proto3";

package shopping.product.actions;

import "akkaserverless/annotations.proto";
import "cart/shopping_cart_domain.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";

service ToProductPopularityService {

  <i class="conum" data-value="1"></i><b>(1)</b>
  rpc ForwardAdded(shopping.cart.domain.ItemAdded) returns (google.protobuf.Empty) {
    option (akkaserverless.method).eventing.in = { <i class="conum" data-value="2"></i><b>(2)</b>
      event_sourced_entity: "eventsourced-shopping-cart" <i class="conum" data-value="3"></i><b>(3)</b>
    };
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create rpc methods for all Protobuf types in the journal</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate the methods with <code>(akkaserverless.method).eventing</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>specify the Event Sourced Entity&#8217;s type name as journal source</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is nothing specific required in the implementation of these methods. The implementation usually is an Action that forwards a converted message to a different component (e.g. an Event Sourced Entity).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_subscribing_to_events_from_a_different_service"><a class="anchor" href="#_subscribing_to_events_from_a_different_service"></a>Subscribing to events from a different service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The approach described above works within a service. To subscribe to
events from a different service, you would use <a href="topic-eventing.html" class="page">Publishing and subscribing</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ignoring_events"><a class="anchor" href="#_ignoring_events"></a>Ignoring events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When listening to an event log, <strong>all</strong> events emitted by the Event Sourced entity must be matched by a Protobuf service method. In case your component is interested only in certain events, you may declare a method to receive all events that are not received by the other methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-protobuf hljs" data-lang="protobuf">  // handle other events which are not managed above
  rpc CatchOthers(google.protobuf.Any) returns (google.protobuf.Empty) {
    option (akkaserverless.method).eventing.in = {
      event_sourced_entity:  "eventsourced-shopping-cart"
    };
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding implementation must exist in the component.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="forwarding.html">Forwarding and effects</a></span>
  <span class="next"><a href="topic-eventing.html">Publishing and Subscribing</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer><script>window.uiRootPath = '../_'</script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/dist/theme.1.0.3.min.js"></script>

<!--Footer Scripts Lightbend Specific-->
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TGBHM8D');</script>
<!-- End Google Tag Manager -->

<!-- Aha Feedback Widget -->
<script type="text/plain" class="optanon-category-3" async="async">
	function createUUID() {
		return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
			var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
			return v.toString(16);
		});
	}

	u = createUUID();

	(function (w, d, s, o, f, js, fjs) {
		w['aha-widget'] = o; w[o] = w[o] || function () { (w[o].q = w[o].q || []).push(arguments); };
		js = d.createElement(s); fjs = d.getElementsByTagName(s)[0]; js.id = o; js.src = f; js.async = 1; fjs.parentNode.insertBefore(js, fjs);
	})(window, document, 'script', 'aha', 'https://cdn.aha.io:443/assets/feedback/feedback.js');

	aha('initialize', {
		account: 'lightbend',
		applicationId: '7000060812484679534',
		user: {
			id: u,
			name: 'as-user-'+u,
			email: 'as-user-'+u+'+docs@lightbend.com',
		},
	});
</script>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/plain" class="optanon-category-4" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5528d33a542dd356" async="async">  </body>
</html>